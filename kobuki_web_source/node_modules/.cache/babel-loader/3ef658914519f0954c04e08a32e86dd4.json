{"ast":null,"code":"(function (f) {\n  if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n    module.exports = f();\n  } else if (typeof define === \"function\" && define.amd) {\n    define([], f);\n  } else {\n    var g;\n\n    if (typeof window !== \"undefined\") {\n      g = window;\n    } else if (typeof global !== \"undefined\") {\n      g = global;\n    } else if (typeof self !== \"undefined\") {\n      g = self;\n    } else {\n      g = this;\n    }\n\n    g.nipplejs = f();\n  }\n})(function () {\n  var define, module, exports;\n  'use strict'; // Constants\n\n\n  var isTouch = !!('ontouchstart' in window);\n  var isPointer = window.PointerEvent ? true : false;\n  var isMSPointer = window.MSPointerEvent ? true : false;\n  var events = {\n    touch: {\n      start: 'touchstart',\n      move: 'touchmove',\n      end: 'touchend, touchcancel'\n    },\n    mouse: {\n      start: 'mousedown',\n      move: 'mousemove',\n      end: 'mouseup'\n    },\n    pointer: {\n      start: 'pointerdown',\n      move: 'pointermove',\n      end: 'pointerup'\n    },\n    MSPointer: {\n      start: 'MSPointerDown',\n      move: 'MSPointerMove',\n      end: 'MSPointerUp'\n    }\n  };\n  var toBind;\n  var secondBind = {};\n\n  if (isPointer) {\n    toBind = events.pointer;\n  } else if (isMSPointer) {\n    toBind = events.MSPointer;\n  } else if (isTouch) {\n    toBind = events.touch;\n    secondBind = events.mouse;\n  } else {\n    toBind = events.mouse;\n  } ///////////////////////\n  ///      UTILS      ///\n  ///////////////////////\n\n\n  var u = {};\n\n  u.distance = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  u.angle = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n    return u.degrees(Math.atan2(dy, dx));\n  };\n\n  u.findCoord = function (p, d, a) {\n    var b = {\n      x: 0,\n      y: 0\n    };\n    a = u.radians(a);\n    b.x = p.x - d * Math.cos(a);\n    b.y = p.y - d * Math.sin(a);\n    return b;\n  };\n\n  u.radians = function (a) {\n    return a * (Math.PI / 180);\n  };\n\n  u.degrees = function (a) {\n    return a * (180 / Math.PI);\n  };\n\n  u.bindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (el.addEventListener) {\n        el.addEventListener(type, handler, false);\n      } else if (el.attachEvent) {\n        el.attachEvent(type, handler);\n      }\n    }\n  };\n\n  u.unbindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (el.removeEventListener) {\n        el.removeEventListener(type, handler);\n      } else if (el.detachEvent) {\n        el.detachEvent(type, handler);\n      }\n    }\n  };\n\n  u.trigger = function (el, type, data) {\n    var evt = new CustomEvent(type, data);\n    el.dispatchEvent(evt);\n  };\n\n  u.prepareEvent = function (evt) {\n    evt.preventDefault();\n    return evt.type.match(/^touch/) ? evt.changedTouches : evt;\n  };\n\n  u.getScroll = function () {\n    var x = window.pageXOffset !== undefined ? window.pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft;\n    var y = window.pageYOffset !== undefined ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  u.applyPosition = function (el, pos) {\n    if (pos.x && pos.y) {\n      el.style.left = pos.x + 'px';\n      el.style.top = pos.y + 'px';\n    } else if (pos.top || pos.right || pos.bottom || pos.left) {\n      el.style.top = pos.top;\n      el.style.right = pos.right;\n      el.style.bottom = pos.bottom;\n      el.style.left = pos.left;\n    }\n  };\n\n  u.getTransitionStyle = function (property, values, time) {\n    var obj = u.configStylePropertyObject(property);\n\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        if (typeof values === 'string') {\n          obj[i] = values + ' ' + time;\n        } else {\n          var st = '';\n\n          for (var j = 0, max = values.length; j < max; j += 1) {\n            st += values[j] + ' ' + time + ', ';\n          }\n\n          obj[i] = st.slice(0, -2);\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  u.getVendorStyle = function (property, value) {\n    var obj = u.configStylePropertyObject(property);\n\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        obj[i] = value;\n      }\n    }\n\n    return obj;\n  };\n\n  u.configStylePropertyObject = function (prop) {\n    var obj = {};\n    obj[prop] = '';\n    var vendors = ['webkit', 'Moz', 'o'];\n    vendors.forEach(function (vendor) {\n      obj[vendor + prop.charAt(0).toUpperCase() + prop.slice(1)] = '';\n    });\n    return obj;\n  };\n\n  u.extend = function (objA, objB) {\n    for (var i in objB) {\n      if (objB.hasOwnProperty(i)) {\n        objA[i] = objB[i];\n      }\n    }\n\n    return objA;\n  }; // Overwrite only what's already present\n\n\n  u.safeExtend = function (objA, objB) {\n    var obj = {};\n\n    for (var i in objA) {\n      if (objA.hasOwnProperty(i) && objB.hasOwnProperty(i)) {\n        obj[i] = objB[i];\n      } else if (objA.hasOwnProperty(i)) {\n        obj[i] = objA[i];\n      }\n    }\n\n    return obj;\n  }; // Map for array or unique item.\n\n\n  u.map = function (ar, fn) {\n    if (ar.length) {\n      for (var i = 0, max = ar.length; i < max; i += 1) {\n        fn(ar[i]);\n      }\n    } else {\n      fn(ar);\n    }\n  }; ///////////////////////\n  ///   SUPER CLASS   ///\n  ///////////////////////\n\n\n  function Super() {}\n\n  ; // Basic event system.\n\n  Super.prototype.on = function (arg, cb) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n      self._handlers_[type] = self._handlers_[type] || [];\n\n      self._handlers_[type].push(cb);\n    }\n\n    return self;\n  };\n\n  Super.prototype.off = function (type, cb) {\n    var self = this;\n    self._handlers_ = self._handlers_ || {};\n\n    if (type === undefined) {\n      self._handlers_ = {};\n    } else if (cb === undefined) {\n      self._handlers_[type] = null;\n    } else if (self._handlers_[type] && self._handlers_[type].indexOf(cb) >= 0) {\n      self._handlers_[type].splice(self._handlers_[type].indexOf(cb), 1);\n    }\n\n    return self;\n  };\n\n  Super.prototype.trigger = function (arg, data) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (self._handlers_[type] && self._handlers_[type].length) {\n        self._handlers_[type].forEach(function (handler) {\n          handler.call(self, {\n            type: type,\n            target: self\n          }, data);\n        });\n      }\n    }\n  }; // Configuration\n\n\n  Super.prototype.config = function (options) {\n    var self = this;\n    self.options = self.defaults || {};\n\n    if (options) {\n      self.options = u.safeExtend(self.options, options);\n    }\n  }; // Bind internal events.\n\n\n  Super.prototype.bindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    self._domHandlers_[type] = function () {\n      if (typeof self['on' + type] === 'function') {\n        self['on' + type].apply(self, arguments);\n      } else {\n        console.warn('[WARNING] : Missing \"on' + type + '\" handler.');\n      }\n    };\n\n    u.bindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n      // Support for both touch and mouse at the same time.\n      u.bindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    return self;\n  }; // Unbind dom events.\n\n\n  Super.prototype.unbindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n    u.unbindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n      // Support for both touch and mouse at the same time.\n      u.unbindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    delete self._domHandlers_[type];\n    return this;\n  }; ///////////////////////\n  ///   THE NIPPLE    ///\n  ///////////////////////\n\n\n  function Nipple(collection, options) {\n    this.identifier = options.identifier;\n    this.position = options.position;\n    this.frontPosition = options.frontPosition;\n    this.collection = collection; // Defaults\n\n    this.defaults = {\n      size: 100,\n      threshold: 0.1,\n      color: 'white',\n      fadeTime: 250,\n      dataOnly: false,\n      restJoystick: true,\n      restOpacity: 0.5,\n      mode: 'dynamic',\n      zone: document.body\n    };\n    this.config(options); // Overwrites\n\n    if (this.options.mode === 'dynamic') {\n      this.options.restOpacity = 0;\n    }\n\n    this.id = Nipple.id;\n    Nipple.id += 1;\n    this.buildEl().stylize(); // Nipple's API.\n\n    this.instance = {\n      el: this.ui.el,\n      on: this.on.bind(this),\n      off: this.off.bind(this),\n      show: this.show.bind(this),\n      hide: this.hide.bind(this),\n      add: this.addToDom.bind(this),\n      remove: this.removeFromDom.bind(this),\n      destroy: this.destroy.bind(this),\n      resetDirection: this.resetDirection.bind(this),\n      computeDirection: this.computeDirection.bind(this),\n      trigger: this.trigger.bind(this),\n      position: this.position,\n      frontPosition: this.frontPosition,\n      ui: this.ui,\n      identifier: this.identifier,\n      id: this.id,\n      options: this.options\n    };\n    return this.instance;\n  }\n\n  ;\n  Nipple.prototype = new Super();\n  Nipple.constructor = Nipple;\n  Nipple.id = 0; // Build the dom element of the Nipple instance.\n\n  Nipple.prototype.buildEl = function (options) {\n    this.ui = {};\n\n    if (this.options.dataOnly) {\n      return this;\n    }\n\n    this.ui.el = document.createElement('div');\n    this.ui.back = document.createElement('div');\n    this.ui.front = document.createElement('div');\n    this.ui.el.className = 'nipple collection_' + this.collection.id;\n    this.ui.back.className = 'back';\n    this.ui.front.className = 'front';\n    this.ui.el.setAttribute('id', 'nipple_' + this.collection.id + '_' + this.id);\n    this.ui.el.appendChild(this.ui.back);\n    this.ui.el.appendChild(this.ui.front);\n    return this;\n  }; // Apply CSS to the Nipple instance.\n\n\n  Nipple.prototype.stylize = function () {\n    if (this.options.dataOnly) {\n      return this;\n    }\n\n    var animTime = this.options.fadeTime + 'ms';\n    var borderStyle = u.getVendorStyle('borderRadius', '50%');\n    var transitStyle = u.getTransitionStyle('transition', 'opacity', animTime);\n    var styles = {};\n    styles.el = {\n      position: 'absolute',\n      opacity: this.options.restOpacity,\n      display: 'block',\n      'zIndex': 999\n    };\n    styles.back = {\n      position: 'absolute',\n      display: 'block',\n      width: this.options.size + 'px',\n      height: this.options.size + 'px',\n      marginLeft: -this.options.size / 2 + 'px',\n      marginTop: -this.options.size / 2 + 'px',\n      background: this.options.color,\n      'opacity': '.5'\n    };\n    styles.front = {\n      width: this.options.size / 2 + 'px',\n      height: this.options.size / 2 + 'px',\n      position: 'absolute',\n      display: 'block',\n      marginLeft: -this.options.size / 4 + 'px',\n      marginTop: -this.options.size / 4 + 'px',\n      background: this.options.color,\n      'opacity': '.5'\n    };\n    u.extend(styles.el, transitStyle);\n    u.extend(styles.back, borderStyle);\n    u.extend(styles.front, borderStyle);\n    this.applyStyles(styles);\n    return this;\n  };\n\n  Nipple.prototype.applyStyles = function (styles) {\n    // Apply styles\n    for (var i in this.ui) {\n      if (this.ui.hasOwnProperty(i)) {\n        for (var j in styles[i]) {\n          this.ui[i].style[j] = styles[i][j];\n        }\n      }\n    }\n\n    return this;\n  }; // Inject the Nipple instance into DOM.\n\n\n  Nipple.prototype.addToDom = function () {\n    // We're not adding it if we're dataOnly or already in dom.\n    if (this.options.dataOnly || document.body.contains(this.ui.el)) {\n      return this;\n    }\n\n    this.options.zone.appendChild(this.ui.el);\n    return this;\n  }; // Remove the Nipple instance from DOM.\n\n\n  Nipple.prototype.removeFromDom = function () {\n    if (this.options.dataOnly || !document.body.contains(this.ui.el)) {\n      return this;\n    }\n\n    this.options.zone.removeChild(this.ui.el);\n    return this;\n  }; // Entirely destroy this nipple\n\n\n  Nipple.prototype.destroy = function () {\n    clearTimeout(this.removeTimeout);\n    clearTimeout(this.showTimeout);\n    clearTimeout(this.restTimeout);\n    this.trigger('destroyed', this.instance);\n    this.removeFromDom();\n    this.off();\n  }; // Fade in the Nipple instance.\n\n\n  Nipple.prototype.show = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n      return self;\n    }\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n    self.addToDom();\n    self.restCallback();\n    setTimeout(function () {\n      self.ui.el.style.opacity = 1;\n    }, 0);\n    self.showTimeout = setTimeout(function () {\n      self.trigger('shown', self.instance);\n\n      if (typeof cb === 'function') {\n        cb.call(this);\n      }\n    }, self.options.fadeTime);\n    return self;\n  }; // Fade out the Nipple instance.\n\n\n  Nipple.prototype.hide = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n      return self;\n    }\n\n    self.ui.el.style.opacity = self.options.restOpacity;\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n    self.removeTimeout = setTimeout(function () {\n      var display = self.options.mode === 'dynamic' ? 'none' : 'block';\n      self.ui.el.style.display = display;\n\n      if (typeof cb === 'function') {\n        cb.call(self);\n      }\n\n      self.trigger('hidden', self.instance);\n    }, self.options.fadeTime);\n\n    if (self.options.restJoystick) {\n      self.restPosition();\n    }\n\n    return self;\n  };\n\n  Nipple.prototype.restPosition = function (cb) {\n    var self = this;\n    self.frontPosition = {\n      x: 0,\n      y: 0\n    };\n    var animTime = self.options.fadeTime + 'ms';\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', ['top', 'left'], animTime);\n    var styles = {\n      front: {}\n    };\n    styles.front = {\n      left: self.frontPosition.x + 'px',\n      top: self.frontPosition.y + 'px'\n    };\n    self.applyStyles(transitStyle);\n    self.applyStyles(styles);\n    self.restTimeout = setTimeout(function () {\n      if (typeof cb === 'function') {\n        cb.call(self);\n      }\n\n      self.restCallback();\n    }, self.options.fadeTime);\n  };\n\n  Nipple.prototype.restCallback = function () {\n    var self = this;\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', 'none', '');\n    self.applyStyles(transitStyle);\n    self.trigger('rested', self.instance);\n  };\n\n  Nipple.prototype.resetDirection = function () {\n    // Fully rebuild the object to let the iteration possible.\n    this.direction = {\n      x: false,\n      y: false,\n      angle: false\n    };\n  };\n\n  Nipple.prototype.computeDirection = function (obj) {\n    var rAngle = obj.angle.radian;\n    var angle45 = Math.PI / 4;\n    var angle90 = Math.PI / 2;\n    var direction, directionX, directionY; // Angular direction\n    //     \\  UP /\n    //      \\   /\n    // LEFT       RIGHT\n    //      /   \\\n    //     /DOWN \\\n    //\n\n    if (rAngle > angle45 && rAngle < angle45 * 3) {\n      direction = 'up';\n    } else if (rAngle > -angle45 && rAngle <= angle45) {\n      direction = 'left';\n    } else if (rAngle > -angle45 * 3 && rAngle <= -angle45) {\n      direction = 'down';\n    } else {\n      direction = 'right';\n    } // Plain direction\n    //    UP                 |\n    // _______               | RIGHT\n    //                  LEFT |\n    //   DOWN                |\n\n\n    if (rAngle > -angle90 && rAngle < angle90) {\n      directionX = 'left';\n    } else {\n      directionX = 'right';\n    }\n\n    if (rAngle > 0) {\n      directionY = 'up';\n    } else {\n      directionY = 'down';\n    }\n\n    if (obj.force > this.options.threshold) {\n      var oldDirection = {};\n\n      for (var i in this.direction) {\n        if (this.direction.hasOwnProperty(i)) {\n          oldDirection[i] = this.direction[i];\n        }\n      }\n\n      var same = {};\n      this.direction = {\n        x: directionX,\n        y: directionY,\n        angle: direction\n      };\n      obj.direction = this.direction;\n\n      for (var i in oldDirection) {\n        if (oldDirection[i] === this.direction[i]) {\n          same[i] = true;\n        }\n      } // If all 3 directions are the same, we don't trigger anything.\n\n\n      if (same.x && same.y && same.angle) {\n        return obj;\n      }\n\n      if (!same.x || !same.y) {\n        this.trigger('plain', obj);\n      }\n\n      if (!same.x) {\n        this.trigger('plain:' + directionX, obj);\n      }\n\n      if (!same.y) {\n        this.trigger('plain:' + directionY, obj);\n      }\n\n      if (!same.angle) {\n        this.trigger('dir dir:' + direction, obj);\n      }\n    }\n\n    return obj;\n  };\n  /* global Nipple, Super */\n  ///////////////////////////\n  ///   THE COLLECTION    ///\n  ///////////////////////////\n\n\n  function Collection(manager, options) {\n    var self = this;\n    self.nipples = [];\n    self.idles = [];\n    self.actives = [];\n    self.ids = [];\n    self.pressureIntervals = {};\n    self.manager = manager;\n    self.id = Collection.id;\n    Collection.id += 1; // Defaults\n\n    self.defaults = {\n      zone: document.body,\n      multitouch: false,\n      maxNumberOfNipples: 10,\n      mode: 'dynamic',\n      position: {\n        top: 0,\n        left: 0\n      },\n      catchDistance: 200,\n      size: 100,\n      threshold: 0.1,\n      color: 'white',\n      fadeTime: 250,\n      dataOnly: false,\n      restJoystick: true,\n      restOpacity: 0.5\n    };\n    self.config(options); // Overwrites\n\n    if (self.options.mode === 'static' || self.options.mode === 'semi') {\n      self.options.multitouch = false;\n    }\n\n    if (!self.options.multitouch) {\n      self.options.maxNumberOfNipples = 1;\n    }\n\n    self.updateBox();\n    self.prepareNipples();\n    self.bindings();\n    self.begin();\n    return self.nipples;\n  }\n\n  Collection.prototype = new Super();\n  Collection.constructor = Collection;\n  Collection.id = 0;\n\n  Collection.prototype.prepareNipples = function () {\n    var self = this;\n    var nips = self.nipples; // Public API Preparation.\n\n    nips.on = self.on.bind(self);\n    nips.off = self.off.bind(self);\n    nips.options = self.options;\n    nips.destroy = self.destroy.bind(self);\n    nips.ids = self.ids;\n    nips.id = self.id;\n    nips.processOnMove = self.processOnMove.bind(self);\n    nips.processOnEnd = self.processOnEnd.bind(self);\n\n    nips.get = function (id) {\n      if (id === undefined) {\n        return nips[0];\n      }\n\n      for (var i = 0, max = nips.length; i < max; i += 1) {\n        if (nips[i].identifier === id) {\n          return nips[i];\n        }\n      }\n\n      return false;\n    };\n  };\n\n  Collection.prototype.bindings = function () {\n    var self = this; // Touch start event.\n\n    self.bindEvt(self.options.zone, 'start'); // Avoid native touch actions (scroll, zoom etc...) on the zone.\n\n    self.options.zone.style.touchAction = 'none';\n    self.options.zone.style.msTouchAction = 'none';\n  };\n\n  Collection.prototype.begin = function () {\n    var self = this;\n    var opts = self.options; // We place our static nipple\n    // if needed.\n\n    if (opts.mode === 'static') {\n      var nipple = self.createNipple(opts.position, self.manager.getIdentifier()); // Add it to the dom.\n\n      nipple.add(); // Store it in idles.\n\n      self.idles.push(nipple);\n    }\n  }; // Nipple Factory\n\n\n  Collection.prototype.createNipple = function (position, identifier) {\n    var self = this;\n    var scroll = u.getScroll();\n    var toPutOn = {};\n    var opts = self.options;\n\n    if (position.x && position.y) {\n      toPutOn = {\n        x: position.x - (scroll.x + self.box.left),\n        y: position.y - (scroll.y + self.box.top)\n      };\n    } else if (position.top || position.right || position.bottom || position.left) {\n      // We need to compute the position X / Y of the joystick.\n      var dumb = document.createElement('DIV');\n      dumb.style.display = 'hidden';\n      dumb.style.top = position.top;\n      dumb.style.right = position.right;\n      dumb.style.bottom = position.bottom;\n      dumb.style.left = position.left;\n      dumb.style.position = 'absolute';\n      opts.zone.appendChild(dumb);\n      var dumbBox = dumb.getBoundingClientRect();\n      opts.zone.removeChild(dumb);\n      toPutOn = position;\n      position = {\n        x: dumbBox.left + scroll.x,\n        y: dumbBox.top + scroll.y\n      };\n    }\n\n    var nipple = new Nipple(self, {\n      color: opts.color,\n      size: opts.size,\n      threshold: opts.threshold,\n      fadeTime: opts.fadeTime,\n      dataOnly: opts.dataOnly,\n      restJoystick: opts.restJoystick,\n      restOpacity: opts.restOpacity,\n      mode: opts.mode,\n      identifier: identifier,\n      position: position,\n      zone: opts.zone,\n      frontPosition: {\n        x: 0,\n        y: 0\n      }\n    });\n\n    if (!opts.dataOnly) {\n      u.applyPosition(nipple.ui.el, toPutOn);\n      u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n\n    self.nipples.push(nipple);\n    self.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.manager.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.bindNipple(nipple);\n    return nipple;\n  };\n\n  Collection.prototype.updateBox = function () {\n    var self = this;\n    self.box = self.options.zone.getBoundingClientRect();\n  };\n\n  Collection.prototype.bindNipple = function (nipple) {\n    var self = this;\n    var type; // Bubble up identified events.\n\n    var handler = function (evt, data) {\n      // Identify the event type with the nipple's id.\n      type = evt.type + ' ' + data.id + ':' + evt.type;\n      self.trigger(type, data);\n    }; // When it gets destroyed.\n\n\n    nipple.on('destroyed', self.onDestroyed.bind(self)); // Other events that will get bubbled up.\n\n    nipple.on('shown hidden rested dir plain', handler);\n    nipple.on('dir:up dir:right dir:down dir:left', handler);\n    nipple.on('plain:up plain:right plain:down plain:left', handler);\n  };\n\n  Collection.prototype.pressureFn = function (touch, nipple, identifier) {\n    var self = this;\n    var previousPressure = 0;\n    clearInterval(self.pressureIntervals[identifier]); // Create an interval that will read the pressure every 100ms\n\n    self.pressureIntervals[identifier] = setInterval(function () {\n      var pressure = touch.force || touch.pressure || touch.webkitForce || 0;\n\n      if (pressure !== previousPressure) {\n        nipple.trigger('pressure', pressure);\n        self.trigger('pressure ' + nipple.identifier + ':pressure', pressure);\n        previousPressure = pressure;\n      }\n    }.bind(self), 100);\n  };\n\n  Collection.prototype.onstart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    evt = u.prepareEvent(evt); // Update the box position\n\n    self.updateBox();\n\n    var process = function (touch) {\n      // If we can create new nipples\n      // meaning we don't have more active nipples than we should.\n      if (self.actives.length < opts.maxNumberOfNipples) {\n        self.processOnStart(touch);\n      }\n    };\n\n    u.map(evt, process); // We ask upstream to bind the document\n    // on 'move' and 'end'\n\n    self.manager.bindDocument();\n    return false;\n  };\n\n  Collection.prototype.processOnStart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var indexInIdles;\n    var identifier = self.manager.getIdentifier(evt);\n    var pressure = evt.force || evt.pressure || evt.webkitForce || 0;\n    var position = {\n      x: evt.pageX,\n      y: evt.pageY\n    };\n    var nipple = self.getOrCreate(identifier, position); // Update its touch identifier\n\n    if (nipple.identifier !== identifier) {\n      self.manager.removeIdentifier(nipple.identifier);\n    }\n\n    nipple.identifier = identifier;\n\n    var process = function (nip) {\n      // Trigger the start.\n      nip.trigger('start', nip);\n      self.trigger('start ' + nip.id + ':start', nip);\n      nip.show();\n\n      if (pressure > 0) {\n        self.pressureFn(evt, nip, nip.identifier);\n      } // Trigger the first move event.\n\n\n      self.processOnMove(evt);\n    }; // Transfer it from idles to actives.\n\n\n    if ((indexInIdles = self.idles.indexOf(nipple)) >= 0) {\n      self.idles.splice(indexInIdles, 1);\n    } // Store the nipple in the actives array\n\n\n    self.actives.push(nipple);\n    self.ids.push(nipple.identifier);\n\n    if (opts.mode !== 'semi') {\n      process(nipple);\n    } else {\n      // In semi we check the distance of the touch\n      // to decide if we have to reset the nipple\n      var distance = u.distance(position, nipple.position);\n\n      if (distance <= opts.catchDistance) {\n        process(nipple);\n      } else {\n        nipple.destroy();\n        self.processOnStart(evt);\n        return;\n      }\n    }\n\n    return nipple;\n  };\n\n  Collection.prototype.getOrCreate = function (identifier, position) {\n    var self = this;\n    var opts = self.options;\n    var nipple; // If we're in static or semi, we might already have an active.\n\n    if (/(semi|static)/.test(opts.mode)) {\n      // Get the active one.\n      // TODO: Multi-touche for semi and static will start here.\n      // Return the nearest one.\n      nipple = self.idles[0];\n\n      if (nipple) {\n        self.idles.splice(0, 1);\n        return nipple;\n      }\n\n      if (opts.mode === 'semi') {\n        // If we're in semi mode, we need to create one.\n        return self.createNipple(position, identifier);\n      }\n\n      console.warn('Coudln\\'t find the needed nipple.');\n      return false;\n    } // In dynamic, we create a new one.\n\n\n    nipple = self.createNipple(position, identifier);\n    return nipple;\n  };\n\n  Collection.prototype.processOnMove = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n\n    if (!nipple) {\n      // This is here just for safety.\n      // It shouldn't happen.\n      console.error('Found zombie joystick with ID ' + identifier);\n      self.manager.removeIdentifier(identifier);\n      return;\n    }\n\n    nipple.identifier = identifier;\n    var size = nipple.options.size / 2;\n    var pos = {\n      x: evt.pageX,\n      y: evt.pageY\n    };\n    var dist = u.distance(pos, nipple.position);\n    var angle = u.angle(pos, nipple.position);\n    var rAngle = u.radians(angle);\n    var force = dist / size; // If distance is bigger than nipple's size\n    // we clamp the position.\n\n    if (dist > size) {\n      dist = size;\n      pos = u.findCoord(nipple.position, dist, angle);\n    }\n\n    nipple.frontPosition = {\n      x: pos.x - nipple.position.x,\n      y: pos.y - nipple.position.y\n    };\n\n    if (!opts.dataOnly) {\n      u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    } // Prepare event's datas.\n\n\n    var toSend = {\n      identifier: nipple.identifier,\n      position: pos,\n      force: force,\n      pressure: evt.force || evt.pressure || evt.webkitForce || 0,\n      distance: dist,\n      angle: {\n        radian: rAngle,\n        degree: angle\n      },\n      instance: nipple\n    }; // Compute the direction's datas.\n\n    toSend = nipple.computeDirection(toSend); // Offset angles to follow units circle.\n\n    toSend.angle = {\n      radian: u.radians(180 - angle),\n      degree: 180 - angle\n    }; // Send everything to everyone.\n\n    nipple.trigger('move', toSend);\n    self.trigger('move ' + nipple.id + ':move', toSend);\n  };\n\n  Collection.prototype.processOnEnd = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n    var removedIdentifier = self.manager.removeIdentifier(nipple.identifier);\n\n    if (!nipple) {\n      return;\n    }\n\n    if (!opts.dataOnly) {\n      nipple.hide(function () {\n        if (opts.mode === 'dynamic') {\n          nipple.trigger('removed', nipple);\n          self.trigger('removed ' + nipple.id + ':removed', nipple);\n          self.manager.trigger('removed ' + nipple.id + ':removed', nipple);\n          nipple.destroy();\n        }\n      });\n    } // Clear the pressure interval reader\n\n\n    clearInterval(self.pressureIntervals[nipple.identifier]); // Reset the direciton of the nipple, to be able to trigger a new direction\n    // on start.\n\n    nipple.resetDirection();\n    nipple.trigger('end', nipple);\n    self.trigger('end ' + nipple.id + ':end', nipple); // Remove identifier from our bank.\n\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n      self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    } // Clean our actives array.\n\n\n    if (self.actives.indexOf(nipple) >= 0) {\n      self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (/(semi|static)/.test(opts.mode)) {\n      // Transfer nipple from actives to idles\n      // if we're in semi or static mode.\n      self.idles.push(nipple);\n    } else if (self.nipples.indexOf(nipple) >= 0) {\n      // Only if we're not in semi or static mode\n      // we can remove the instance.\n      self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    } // We unbind move and end.\n\n\n    self.manager.unbindDocument(); // We add back the identifier of the idle nipple;\n\n    if (/(semi|static)/.test(opts.mode)) {\n      self.manager.ids[removedIdentifier.id] = removedIdentifier.identifier;\n    }\n  }; // Remove destroyed nipple from the lists\n\n\n  Collection.prototype.onDestroyed = function (evt, nipple) {\n    var self = this;\n\n    if (self.nipples.indexOf(nipple) >= 0) {\n      self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n\n    if (self.actives.indexOf(nipple) >= 0) {\n      self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (self.idles.indexOf(nipple) >= 0) {\n      self.idles.splice(self.idles.indexOf(nipple), 1);\n    }\n\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n      self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    } // Remove the identifier from our bank\n\n\n    self.manager.removeIdentifier(nipple.identifier); // We unbind move and end.\n\n    self.manager.unbindDocument();\n  }; // Cleanly destroy the manager\n\n\n  Collection.prototype.destroy = function () {\n    var self = this;\n    self.unbindEvt(self.options.zone, 'start'); // Destroy nipples.\n\n    self.nipples.forEach(function (nipple) {\n      nipple.destroy();\n    }); // Clean 3DTouch intervals.\n\n    for (var i in self.pressureIntervals) {\n      if (self.pressureIntervals.hasOwnProperty(i)) {\n        clearInterval(self.pressureIntervals[i]);\n      }\n    } // Notify the manager passing the instance\n\n\n    self.trigger('destroyed', self.nipples); // We unbind move and end.\n\n    self.manager.unbindDocument(); // Unbind everything.\n\n    self.off();\n  };\n  /* global u, Super, Collection */\n  ///////////////////////\n  ///     MANAGER     ///\n  ///////////////////////\n\n\n  function Manager(options) {\n    var self = this;\n    self.ids = {};\n    self.index = 0;\n    self.collections = [];\n    self.config(options);\n    self.prepareCollections(); // Listen for resize, to reposition every joysticks\n\n    var resizeTimer;\n    u.bindEvt(window, 'resize', function (evt) {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(function () {\n        var pos;\n        var scroll = u.getScroll();\n        self.collections.forEach(function (collection) {\n          collection.forEach(function (nipple) {\n            pos = nipple.el.getBoundingClientRect();\n            nipple.position = {\n              x: scroll.x + pos.left,\n              y: scroll.y + pos.top\n            };\n          });\n        });\n      }, 100);\n    });\n    return self.collections;\n  }\n\n  ;\n  Manager.prototype = new Super();\n  Manager.constructor = Manager;\n\n  Manager.prototype.prepareCollections = function () {\n    var self = this; // Public API Preparation.\n\n    self.collections.create = self.create.bind(self); // Listen to anything\n\n    self.collections.on = self.on.bind(self); // Unbind general events\n\n    self.collections.off = self.off.bind(self); // Destroy everything\n\n    self.collections.destroy = self.destroy.bind(self); // Get any nipple\n\n    self.collections.get = function (id) {\n      var nipple;\n      self.collections.every(function (collection) {\n        if (nipple = collection.get(id)) {\n          return false;\n        }\n\n        return true;\n      });\n      return nipple;\n    };\n  };\n\n  Manager.prototype.create = function (options) {\n    return this.createCollection(options);\n  }; // Collection Factory\n\n\n  Manager.prototype.createCollection = function (options) {\n    var self = this;\n    var collection = new Collection(self, options);\n    self.bindCollection(collection);\n    self.collections.push(collection);\n    return collection;\n  };\n\n  Manager.prototype.bindCollection = function (collection) {\n    var self = this;\n    var type; // Bubble up identified events.\n\n    var handler = function (evt, data) {\n      // Identify the event type with the nipple's identifier.\n      type = evt.type + ' ' + data.id + ':' + evt.type;\n      self.trigger(type, data);\n    }; // When it gets destroyed we clean.\n\n\n    collection.on('destroyed', self.onDestroyed.bind(self)); // Other events that will get bubbled up.\n\n    collection.on('shown hidden rested dir plain', handler);\n    collection.on('dir:up dir:right dir:down dir:left', handler);\n    collection.on('plain:up plain:right plain:down plain:left', handler);\n  };\n\n  Manager.prototype.bindDocument = function () {\n    var self = this; // Bind only if not already binded\n\n    if (!self.binded) {\n      self.bindEvt(document, 'move').bindEvt(document, 'end');\n      self.binded = true;\n    }\n  };\n\n  Manager.prototype.unbindDocument = function (force) {\n    var self = this; // If there are no touch left\n    // unbind the document.\n\n    if (!Object.keys(self.ids).length || force === true) {\n      self.unbindEvt(document, 'move').unbindEvt(document, 'end');\n      self.binded = false;\n    }\n  };\n\n  Manager.prototype.getIdentifier = function (evt) {\n    var id; // If no event, simple increment\n\n    if (!evt) {\n      id = this.index;\n    } else {\n      // Extract identifier from event object.\n      // Unavailable in mouse events so replaced by latest increment.\n      id = evt.identifier === undefined ? evt.pointerId : evt.identifier;\n\n      if (id === undefined) {\n        id = this.latest || 0;\n      }\n    }\n\n    if (this.ids[id] === undefined) {\n      this.ids[id] = this.index;\n      this.index += 1;\n    } // Keep the latest id used in case we're using an unidentified mouseEvent\n\n\n    this.latest = id;\n    return this.ids[id];\n  };\n\n  Manager.prototype.removeIdentifier = function (identifier) {\n    var removed = {};\n\n    for (var id in this.ids) {\n      if (this.ids[id] === identifier) {\n        removed.id = id;\n        removed.identifier = this.ids[id];\n        delete this.ids[id];\n        break;\n      }\n    }\n\n    return removed;\n  };\n\n  Manager.prototype.onmove = function (evt) {\n    var self = this;\n    self.onAny('move', evt);\n    return false;\n  };\n\n  Manager.prototype.onend = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n  };\n\n  Manager.prototype.onAny = function (which, evt) {\n    var self = this;\n    var id;\n    var processFn = 'processOn' + which.charAt(0).toUpperCase() + which.slice(1);\n    evt = u.prepareEvent(evt);\n\n    var processColl = function (e, id, coll) {\n      if (coll.ids.indexOf(id) >= 0) {\n        coll[processFn](e); // Mark the event to avoid cleaning it later.\n\n        e._found_ = true;\n      }\n    };\n\n    var processEvt = function (e) {\n      id = self.getIdentifier(e);\n      u.map(self.collections, processColl.bind(null, e, id)); // If the event isn't handled by any collection,\n      // we need to clean its identifier.\n\n      if (!e._found_) {\n        self.removeIdentifier(id);\n      }\n    };\n\n    u.map(evt, processEvt);\n    return false;\n  }; // Cleanly destroy the manager\n\n\n  Manager.prototype.destroy = function () {\n    var self = this;\n    self.unbindDocument(true);\n    self.ids = {};\n    self.index = 0;\n    self.collections.forEach(function (collection) {\n      collection.destroy();\n    });\n    self.off();\n  }; // When a collection gets destroyed\n  // we clean behind.\n\n\n  Manager.prototype.onDestroyed = function (evt, coll) {\n    var self = this;\n\n    if (self.collections.indexOf(coll) < 0) {\n      return false;\n    }\n\n    self.collections.splice(self.collections.indexOf(coll), 1);\n  };\n\n  var factory = new Manager();\n  return {\n    create: function (options) {\n      return factory.create(options);\n    },\n    factory: factory\n  };\n});","map":{"version":3,"sources":["/home/binhlee/Desktop/kobuki_web_source/node_modules/nipplejs/dist/nipplejs.js"],"names":["f","exports","module","define","amd","g","window","global","self","nipplejs","isTouch","isPointer","PointerEvent","isMSPointer","MSPointerEvent","events","touch","start","move","end","mouse","pointer","MSPointer","toBind","secondBind","u","distance","p1","p2","dx","x","dy","y","Math","sqrt","angle","degrees","atan2","findCoord","p","d","a","b","radians","cos","sin","PI","bindEvt","el","arg","handler","types","split","type","i","length","addEventListener","attachEvent","unbindEvt","removeEventListener","detachEvent","trigger","data","evt","CustomEvent","dispatchEvent","prepareEvent","preventDefault","match","changedTouches","getScroll","pageXOffset","undefined","document","documentElement","body","parentNode","scrollLeft","pageYOffset","scrollTop","applyPosition","pos","style","left","top","right","bottom","getTransitionStyle","property","values","time","obj","configStylePropertyObject","hasOwnProperty","st","j","max","slice","getVendorStyle","value","prop","vendors","forEach","vendor","charAt","toUpperCase","extend","objA","objB","safeExtend","map","ar","fn","Super","prototype","on","cb","_handlers_","push","off","indexOf","splice","call","target","config","options","defaults","_domHandlers_","apply","arguments","console","warn","Nipple","collection","identifier","position","frontPosition","size","threshold","color","fadeTime","dataOnly","restJoystick","restOpacity","mode","zone","id","buildEl","stylize","instance","ui","bind","show","hide","add","addToDom","remove","removeFromDom","destroy","resetDirection","computeDirection","constructor","createElement","back","front","className","setAttribute","appendChild","animTime","borderStyle","transitStyle","styles","opacity","display","width","height","marginLeft","marginTop","background","applyStyles","contains","removeChild","clearTimeout","removeTimeout","showTimeout","restTimeout","restCallback","setTimeout","restPosition","direction","rAngle","radian","angle45","angle90","directionX","directionY","force","oldDirection","same","Collection","manager","nipples","idles","actives","ids","pressureIntervals","multitouch","maxNumberOfNipples","catchDistance","updateBox","prepareNipples","bindings","begin","nips","processOnMove","processOnEnd","get","touchAction","msTouchAction","opts","nipple","createNipple","getIdentifier","scroll","toPutOn","box","dumb","dumbBox","getBoundingClientRect","bindNipple","onDestroyed","pressureFn","previousPressure","clearInterval","setInterval","pressure","webkitForce","onstart","process","processOnStart","bindDocument","indexInIdles","pageX","pageY","getOrCreate","removeIdentifier","nip","test","error","dist","toSend","degree","removedIdentifier","unbindDocument","Manager","index","collections","prepareCollections","resizeTimer","create","every","createCollection","bindCollection","binded","Object","keys","pointerId","latest","removed","onmove","onAny","onend","which","processFn","processColl","e","coll","_found_","processEvt","factory"],"mappings":"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","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.nipplejs = f()}})(function(){var define,module,exports;\n'use strict';\n\n// Constants\nvar isTouch = !!('ontouchstart' in window);\nvar isPointer = window.PointerEvent ? true : false;\nvar isMSPointer = window.MSPointerEvent ? true : false;\nvar events = {\n    touch: {\n        start: 'touchstart',\n        move: 'touchmove',\n        end: 'touchend, touchcancel'\n    },\n    mouse: {\n        start: 'mousedown',\n        move: 'mousemove',\n        end: 'mouseup'\n    },\n    pointer: {\n        start: 'pointerdown',\n        move: 'pointermove',\n        end: 'pointerup'\n    },\n    MSPointer: {\n        start: 'MSPointerDown',\n        move: 'MSPointerMove',\n        end: 'MSPointerUp'\n    }\n};\nvar toBind;\nvar secondBind = {};\nif (isPointer) {\n    toBind = events.pointer;\n} else if (isMSPointer) {\n    toBind = events.MSPointer;\n} else if (isTouch) {\n    toBind = events.touch;\n    secondBind = events.mouse;\n} else {\n    toBind = events.mouse;\n}\n\n///////////////////////\n///      UTILS      ///\n///////////////////////\n\nvar u = {};\nu.distance = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n\n    return Math.sqrt((dx * dx) + (dy * dy));\n};\n\nu.angle = function(p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n\n    return u.degrees(Math.atan2(dy, dx));\n};\n\nu.findCoord = function(p, d, a) {\n    var b = {x: 0, y: 0};\n    a = u.radians(a);\n    b.x = p.x - d * Math.cos(a);\n    b.y = p.y - d * Math.sin(a);\n    return b;\n};\n\nu.radians = function(a) {\n    return a * (Math.PI / 180);\n};\n\nu.degrees = function(a) {\n    return a * (180 / Math.PI);\n};\n\nu.bindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (el.addEventListener) {\n            el.addEventListener(type, handler, false);\n        } else if (el.attachEvent) {\n            el.attachEvent(type, handler);\n        }\n    }\n};\n\nu.unbindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (el.removeEventListener) {\n            el.removeEventListener(type, handler);\n        } else if (el.detachEvent) {\n            el.detachEvent(type, handler);\n        }\n    }\n};\n\nu.trigger = function (el, type, data) {\n    var evt = new CustomEvent(type, data);\n    el.dispatchEvent(evt);\n};\n\nu.prepareEvent = function (evt) {\n    evt.preventDefault();\n    return evt.type.match(/^touch/) ? evt.changedTouches : evt;\n};\n\nu.getScroll = function () {\n    var x = (window.pageXOffset !== undefined) ?\n        window.pageXOffset :\n        (document.documentElement || document.body.parentNode || document.body)\n            .scrollLeft;\n\n    var y = (window.pageYOffset !== undefined) ?\n        window.pageYOffset :\n        (document.documentElement || document.body.parentNode || document.body)\n            .scrollTop;\n    return {\n        x: x,\n        y: y\n    };\n};\n\nu.applyPosition = function (el, pos) {\n    if (pos.x && pos.y) {\n        el.style.left = pos.x + 'px';\n        el.style.top = pos.y + 'px';\n    } else if (pos.top || pos.right || pos.bottom || pos.left) {\n        el.style.top = pos.top;\n        el.style.right = pos.right;\n        el.style.bottom = pos.bottom;\n        el.style.left = pos.left;\n    }\n};\n\nu.getTransitionStyle = function (property, values, time) {\n    var obj = u.configStylePropertyObject(property);\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (typeof values === 'string') {\n                obj[i] = values + ' ' + time;\n            } else {\n                var st = '';\n                for (var j = 0, max = values.length; j < max; j += 1) {\n                    st += values[j] + ' ' + time + ', ';\n                }\n                obj[i] = st.slice(0, -2);\n            }\n        }\n    }\n    return obj;\n};\n\nu.getVendorStyle = function (property, value) {\n    var obj = u.configStylePropertyObject(property);\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            obj[i] = value;\n        }\n    }\n    return obj;\n};\n\nu.configStylePropertyObject = function (prop) {\n    var obj = {};\n    obj[prop] = '';\n    var vendors = ['webkit', 'Moz', 'o'];\n    vendors.forEach(function (vendor) {\n        obj[vendor + prop.charAt(0).toUpperCase() + prop.slice(1)] = '';\n    });\n    return obj;\n};\n\nu.extend = function (objA, objB) {\n    for (var i in objB) {\n        if (objB.hasOwnProperty(i)) {\n            objA[i] = objB[i];\n        }\n    }\n    return objA;\n};\n\n// Overwrite only what's already present\nu.safeExtend = function (objA, objB) {\n    var obj = {};\n    for (var i in objA) {\n        if (objA.hasOwnProperty(i) && objB.hasOwnProperty(i)) {\n            obj[i] = objB[i];\n        } else if (objA.hasOwnProperty(i)) {\n            obj[i] = objA[i];\n        }\n    }\n    return obj;\n};\n\n// Map for array or unique item.\nu.map = function (ar, fn) {\n    if (ar.length) {\n        for (var i = 0, max = ar.length; i < max; i += 1) {\n            fn(ar[i]);\n        }\n    } else {\n        fn(ar);\n    }\n};\n\n///////////////////////\n///   SUPER CLASS   ///\n///////////////////////\n\nfunction Super () {};\n\n// Basic event system.\nSuper.prototype.on = function (arg, cb) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        self._handlers_[type] = self._handlers_[type] || [];\n        self._handlers_[type].push(cb);\n    }\n    return self;\n};\n\nSuper.prototype.off = function (type, cb) {\n    var self = this;\n    self._handlers_ = self._handlers_ || {};\n\n    if (type === undefined) {\n        self._handlers_ = {};\n    } else if (cb === undefined) {\n        self._handlers_[type] = null;\n    } else if (self._handlers_[type] &&\n            self._handlers_[type].indexOf(cb) >= 0) {\n        self._handlers_[type].splice(self._handlers_[type].indexOf(cb), 1);\n    }\n\n    return self;\n};\n\nSuper.prototype.trigger = function (arg, data) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (self._handlers_[type] && self._handlers_[type].length) {\n            self._handlers_[type].forEach(function (handler) {\n                handler.call(self, {\n                    type: type,\n                    target: self\n                }, data);\n            });\n        }\n    }\n};\n\n// Configuration\nSuper.prototype.config = function (options) {\n    var self = this;\n    self.options = self.defaults || {};\n    if (options) {\n        self.options = u.safeExtend(self.options, options);\n    }\n};\n\n// Bind internal events.\nSuper.prototype.bindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    self._domHandlers_[type] = function () {\n        if (typeof self['on' + type] === 'function') {\n            self['on' + type].apply(self, arguments);\n        } else {\n            console.warn('[WARNING] : Missing \"on' + type + '\" handler.');\n        }\n    };\n\n    u.bindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n        // Support for both touch and mouse at the same time.\n        u.bindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    return self;\n};\n\n// Unbind dom events.\nSuper.prototype.unbindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    u.unbindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n        // Support for both touch and mouse at the same time.\n        u.unbindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    delete self._domHandlers_[type];\n\n    return this;\n};\n\n///////////////////////\n///   THE NIPPLE    ///\n///////////////////////\n\nfunction Nipple (collection, options) {\n    this.identifier = options.identifier;\n    this.position = options.position;\n    this.frontPosition = options.frontPosition;\n    this.collection = collection;\n\n    // Defaults\n    this.defaults = {\n        size: 100,\n        threshold: 0.1,\n        color: 'white',\n        fadeTime: 250,\n        dataOnly: false,\n        restJoystick: true,\n        restOpacity: 0.5,\n        mode: 'dynamic',\n        zone: document.body\n    };\n\n    this.config(options);\n\n    // Overwrites\n    if (this.options.mode === 'dynamic') {\n        this.options.restOpacity = 0;\n    }\n\n    this.id = Nipple.id;\n    Nipple.id += 1;\n    this.buildEl()\n        .stylize();\n\n    // Nipple's API.\n    this.instance = {\n        el: this.ui.el,\n        on: this.on.bind(this),\n        off: this.off.bind(this),\n        show: this.show.bind(this),\n        hide: this.hide.bind(this),\n        add: this.addToDom.bind(this),\n        remove: this.removeFromDom.bind(this),\n        destroy: this.destroy.bind(this),\n        resetDirection: this.resetDirection.bind(this),\n        computeDirection: this.computeDirection.bind(this),\n        trigger: this.trigger.bind(this),\n        position: this.position,\n        frontPosition: this.frontPosition,\n        ui: this.ui,\n        identifier: this.identifier,\n        id: this.id,\n        options: this.options\n    };\n\n    return this.instance;\n};\n\nNipple.prototype = new Super();\nNipple.constructor = Nipple;\nNipple.id = 0;\n\n// Build the dom element of the Nipple instance.\nNipple.prototype.buildEl = function (options) {\n    this.ui = {};\n\n    if (this.options.dataOnly) {\n        return this;\n    }\n\n    this.ui.el = document.createElement('div');\n    this.ui.back = document.createElement('div');\n    this.ui.front = document.createElement('div');\n\n    this.ui.el.className = 'nipple collection_' + this.collection.id;\n    this.ui.back.className = 'back';\n    this.ui.front.className = 'front';\n\n    this.ui.el.setAttribute('id', 'nipple_' + this.collection.id +\n        '_' + this.id);\n\n    this.ui.el.appendChild(this.ui.back);\n    this.ui.el.appendChild(this.ui.front);\n\n    return this;\n};\n\n// Apply CSS to the Nipple instance.\nNipple.prototype.stylize = function () {\n    if (this.options.dataOnly) {\n        return this;\n    }\n    var animTime = this.options.fadeTime + 'ms';\n    var borderStyle = u.getVendorStyle('borderRadius', '50%');\n    var transitStyle = u.getTransitionStyle('transition', 'opacity', animTime);\n    var styles = {};\n    styles.el = {\n        position: 'absolute',\n        opacity: this.options.restOpacity,\n        display: 'block',\n        'zIndex': 999\n    };\n\n    styles.back = {\n        position: 'absolute',\n        display: 'block',\n        width: this.options.size + 'px',\n        height: this.options.size + 'px',\n        marginLeft: -this.options.size / 2 + 'px',\n        marginTop: -this.options.size / 2 + 'px',\n        background: this.options.color,\n        'opacity': '.5'\n    };\n\n    styles.front = {\n        width: this.options.size / 2 + 'px',\n        height: this.options.size / 2 + 'px',\n        position: 'absolute',\n        display: 'block',\n        marginLeft: -this.options.size / 4 + 'px',\n        marginTop: -this.options.size / 4 + 'px',\n        background: this.options.color,\n        'opacity': '.5'\n    };\n\n    u.extend(styles.el, transitStyle);\n    u.extend(styles.back, borderStyle);\n    u.extend(styles.front, borderStyle);\n\n    this.applyStyles(styles);\n\n    return this;\n};\n\nNipple.prototype.applyStyles = function (styles) {\n    // Apply styles\n    for (var i in this.ui) {\n        if (this.ui.hasOwnProperty(i)) {\n            for (var j in styles[i]) {\n                this.ui[i].style[j] = styles[i][j];\n            }\n        }\n    }\n\n    return this;\n};\n\n// Inject the Nipple instance into DOM.\nNipple.prototype.addToDom = function () {\n    // We're not adding it if we're dataOnly or already in dom.\n    if (this.options.dataOnly || document.body.contains(this.ui.el)) {\n        return this;\n    }\n    this.options.zone.appendChild(this.ui.el);\n    return this;\n};\n\n// Remove the Nipple instance from DOM.\nNipple.prototype.removeFromDom = function () {\n    if (this.options.dataOnly || !document.body.contains(this.ui.el)) {\n        return this;\n    }\n    this.options.zone.removeChild(this.ui.el);\n    return this;\n};\n\n// Entirely destroy this nipple\nNipple.prototype.destroy = function () {\n    clearTimeout(this.removeTimeout);\n    clearTimeout(this.showTimeout);\n    clearTimeout(this.restTimeout);\n    this.trigger('destroyed', this.instance);\n    this.removeFromDom();\n    this.off();\n};\n\n// Fade in the Nipple instance.\nNipple.prototype.show = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n        return self;\n    }\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n\n    self.addToDom();\n\n    self.restCallback();\n\n    setTimeout(function () {\n        self.ui.el.style.opacity = 1;\n    }, 0);\n\n    self.showTimeout = setTimeout(function () {\n        self.trigger('shown', self.instance);\n        if (typeof cb === 'function') {\n            cb.call(this);\n        }\n    }, self.options.fadeTime);\n\n    return self;\n};\n\n// Fade out the Nipple instance.\nNipple.prototype.hide = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n        return self;\n    }\n\n    self.ui.el.style.opacity = self.options.restOpacity;\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n\n    self.removeTimeout = setTimeout(\n        function () {\n            var display = self.options.mode === 'dynamic' ? 'none' : 'block';\n            self.ui.el.style.display = display;\n            if (typeof cb === 'function') {\n                cb.call(self);\n            }\n\n            self.trigger('hidden', self.instance);\n        },\n        self.options.fadeTime\n    );\n    if (self.options.restJoystick) {\n        self.restPosition();\n    }\n\n    return self;\n};\n\nNipple.prototype.restPosition = function (cb) {\n    var self = this;\n    self.frontPosition = {\n        x: 0,\n        y: 0\n    };\n    var animTime = self.options.fadeTime + 'ms';\n\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition',\n        ['top', 'left'], animTime);\n\n    var styles = {front: {}};\n    styles.front = {\n        left: self.frontPosition.x + 'px',\n        top: self.frontPosition.y + 'px'\n    };\n\n    self.applyStyles(transitStyle);\n    self.applyStyles(styles);\n\n    self.restTimeout = setTimeout(\n        function () {\n            if (typeof cb === 'function') {\n                cb.call(self);\n            }\n            self.restCallback();\n        },\n        self.options.fadeTime\n    );\n};\n\nNipple.prototype.restCallback = function () {\n    var self = this;\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', 'none', '');\n    self.applyStyles(transitStyle);\n    self.trigger('rested', self.instance);\n};\n\nNipple.prototype.resetDirection = function () {\n    // Fully rebuild the object to let the iteration possible.\n    this.direction = {\n        x: false,\n        y: false,\n        angle: false\n    };\n};\n\nNipple.prototype.computeDirection = function (obj) {\n    var rAngle = obj.angle.radian;\n    var angle45 = Math.PI / 4;\n    var angle90 = Math.PI / 2;\n    var direction, directionX, directionY;\n\n    // Angular direction\n    //     \\  UP /\n    //      \\   /\n    // LEFT       RIGHT\n    //      /   \\\n    //     /DOWN \\\n    //\n    if (rAngle > angle45 && rAngle < (angle45 * 3)) {\n        direction = 'up';\n    } else if (rAngle > -angle45 && rAngle <= angle45) {\n        direction = 'left';\n    } else if (rAngle > (-angle45 * 3) && rAngle <= -angle45) {\n        direction = 'down';\n    } else {\n        direction = 'right';\n    }\n\n    // Plain direction\n    //    UP                 |\n    // _______               | RIGHT\n    //                  LEFT |\n    //   DOWN                |\n    if (rAngle > -angle90 && rAngle < angle90) {\n        directionX = 'left';\n    } else {\n        directionX = 'right';\n    }\n\n    if (rAngle > 0) {\n        directionY = 'up';\n    } else {\n        directionY = 'down';\n    }\n\n    if (obj.force > this.options.threshold) {\n        var oldDirection = {};\n        for (var i in this.direction) {\n            if (this.direction.hasOwnProperty(i)) {\n                oldDirection[i] = this.direction[i];\n            }\n        }\n\n        var same = {};\n\n        this.direction = {\n            x: directionX,\n            y: directionY,\n            angle: direction\n        };\n\n        obj.direction = this.direction;\n\n        for (var i in oldDirection) {\n            if (oldDirection[i] === this.direction[i]) {\n                same[i] = true;\n            }\n        }\n\n        // If all 3 directions are the same, we don't trigger anything.\n        if (same.x && same.y && same.angle) {\n            return obj;\n        }\n\n        if (!same.x || !same.y) {\n            this.trigger('plain', obj);\n        }\n\n        if (!same.x) {\n            this.trigger('plain:' + directionX, obj);\n        }\n\n        if (!same.y) {\n            this.trigger('plain:' + directionY, obj);\n        }\n\n        if (!same.angle) {\n            this.trigger('dir dir:' + direction, obj);\n        }\n    }\n    return obj;\n};\n\n/* global Nipple, Super */\n\n///////////////////////////\n///   THE COLLECTION    ///\n///////////////////////////\n\nfunction Collection (manager, options) {\n    var self = this;\n    self.nipples = [];\n    self.idles = [];\n    self.actives = [];\n    self.ids = [];\n    self.pressureIntervals = {};\n    self.manager = manager;\n    self.id = Collection.id;\n    Collection.id += 1;\n\n    // Defaults\n    self.defaults = {\n        zone: document.body,\n        multitouch: false,\n        maxNumberOfNipples: 10,\n        mode: 'dynamic',\n        position: {top: 0, left: 0},\n        catchDistance: 200,\n        size: 100,\n        threshold: 0.1,\n        color: 'white',\n        fadeTime: 250,\n        dataOnly: false,\n        restJoystick: true,\n        restOpacity: 0.5\n    };\n\n    self.config(options);\n\n    // Overwrites\n    if (self.options.mode === 'static' || self.options.mode === 'semi') {\n        self.options.multitouch = false;\n    }\n\n    if (!self.options.multitouch) {\n        self.options.maxNumberOfNipples = 1;\n    }\n\n    self.updateBox();\n    self.prepareNipples();\n    self.bindings();\n    self.begin();\n\n    return self.nipples;\n}\n\nCollection.prototype = new Super();\nCollection.constructor = Collection;\nCollection.id = 0;\n\nCollection.prototype.prepareNipples = function () {\n    var self = this;\n    var nips = self.nipples;\n\n    // Public API Preparation.\n    nips.on = self.on.bind(self);\n    nips.off = self.off.bind(self);\n    nips.options = self.options;\n    nips.destroy = self.destroy.bind(self);\n    nips.ids = self.ids;\n    nips.id = self.id;\n    nips.processOnMove = self.processOnMove.bind(self);\n    nips.processOnEnd = self.processOnEnd.bind(self);\n    nips.get = function (id) {\n        if (id === undefined) {\n            return nips[0];\n        }\n        for (var i = 0, max = nips.length; i < max; i += 1) {\n            if (nips[i].identifier === id) {\n                return nips[i];\n            }\n        }\n        return false;\n    };\n};\n\nCollection.prototype.bindings = function () {\n    var self = this;\n    // Touch start event.\n    self.bindEvt(self.options.zone, 'start');\n    // Avoid native touch actions (scroll, zoom etc...) on the zone.\n    self.options.zone.style.touchAction = 'none';\n    self.options.zone.style.msTouchAction = 'none';\n};\n\nCollection.prototype.begin = function () {\n    var self = this;\n    var opts = self.options;\n\n    // We place our static nipple\n    // if needed.\n    if (opts.mode === 'static') {\n        var nipple = self.createNipple(\n            opts.position,\n            self.manager.getIdentifier()\n        );\n        // Add it to the dom.\n        nipple.add();\n        // Store it in idles.\n        self.idles.push(nipple);\n    }\n};\n\n// Nipple Factory\nCollection.prototype.createNipple = function (position, identifier) {\n    var self = this;\n    var scroll = u.getScroll();\n    var toPutOn = {};\n    var opts = self.options;\n\n    if (position.x && position.y) {\n        toPutOn = {\n            x: position.x -\n                (scroll.x + self.box.left),\n            y: position.y -\n                (scroll.y + self.box.top)\n        };\n    } else if (\n            position.top ||\n            position.right ||\n            position.bottom ||\n            position.left\n        ) {\n\n        // We need to compute the position X / Y of the joystick.\n        var dumb = document.createElement('DIV');\n        dumb.style.display = 'hidden';\n        dumb.style.top = position.top;\n        dumb.style.right = position.right;\n        dumb.style.bottom = position.bottom;\n        dumb.style.left = position.left;\n        dumb.style.position = 'absolute';\n\n        opts.zone.appendChild(dumb);\n        var dumbBox = dumb.getBoundingClientRect();\n        opts.zone.removeChild(dumb);\n\n        toPutOn = position;\n        position = {\n            x: dumbBox.left + scroll.x,\n            y: dumbBox.top + scroll.y\n        };\n    }\n\n    var nipple = new Nipple(self, {\n        color: opts.color,\n        size: opts.size,\n        threshold: opts.threshold,\n        fadeTime: opts.fadeTime,\n        dataOnly: opts.dataOnly,\n        restJoystick: opts.restJoystick,\n        restOpacity: opts.restOpacity,\n        mode: opts.mode,\n        identifier: identifier,\n        position: position,\n        zone: opts.zone,\n        frontPosition: {\n            x: 0,\n            y: 0\n        }\n    });\n\n    if (!opts.dataOnly) {\n        u.applyPosition(nipple.ui.el, toPutOn);\n        u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n    self.nipples.push(nipple);\n    self.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.manager.trigger('added ' + nipple.identifier + ':added', nipple);\n\n    self.bindNipple(nipple);\n\n    return nipple;\n};\n\nCollection.prototype.updateBox = function () {\n    var self = this;\n    self.box = self.options.zone.getBoundingClientRect();\n};\n\nCollection.prototype.bindNipple = function (nipple) {\n    var self = this;\n    var type;\n    // Bubble up identified events.\n    var handler = function (evt, data) {\n        // Identify the event type with the nipple's id.\n        type = evt.type + ' ' + data.id + ':' + evt.type;\n        self.trigger(type, data);\n    };\n\n    // When it gets destroyed.\n    nipple.on('destroyed', self.onDestroyed.bind(self));\n\n    // Other events that will get bubbled up.\n    nipple.on('shown hidden rested dir plain', handler);\n    nipple.on('dir:up dir:right dir:down dir:left', handler);\n    nipple.on('plain:up plain:right plain:down plain:left', handler);\n};\n\nCollection.prototype.pressureFn = function (touch, nipple, identifier) {\n    var self = this;\n    var previousPressure = 0;\n    clearInterval(self.pressureIntervals[identifier]);\n    // Create an interval that will read the pressure every 100ms\n    self.pressureIntervals[identifier] = setInterval(function () {\n        var pressure = touch.force || touch.pressure ||\n            touch.webkitForce || 0;\n        if (pressure !== previousPressure) {\n            nipple.trigger('pressure', pressure);\n            self.trigger('pressure ' +\n                nipple.identifier + ':pressure', pressure);\n            previousPressure = pressure;\n        }\n    }.bind(self), 100);\n};\n\nCollection.prototype.onstart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    evt = u.prepareEvent(evt);\n\n    // Update the box position\n    self.updateBox();\n\n    var process = function (touch) {\n        // If we can create new nipples\n        // meaning we don't have more active nipples than we should.\n        if (self.actives.length < opts.maxNumberOfNipples) {\n            self.processOnStart(touch);\n        }\n    };\n\n    u.map(evt, process);\n\n    // We ask upstream to bind the document\n    // on 'move' and 'end'\n    self.manager.bindDocument();\n    return false;\n};\n\nCollection.prototype.processOnStart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var indexInIdles;\n    var identifier = self.manager.getIdentifier(evt);\n    var pressure = evt.force || evt.pressure || evt.webkitForce || 0;\n    var position = {\n        x: evt.pageX,\n        y: evt.pageY\n    };\n\n    var nipple = self.getOrCreate(identifier, position);\n\n    // Update its touch identifier\n    if (nipple.identifier !== identifier) {\n        self.manager.removeIdentifier(nipple.identifier);\n    }\n    nipple.identifier = identifier;\n\n    var process = function (nip) {\n        // Trigger the start.\n        nip.trigger('start', nip);\n        self.trigger('start ' + nip.id + ':start', nip);\n\n        nip.show();\n        if (pressure > 0) {\n            self.pressureFn(evt, nip, nip.identifier);\n        }\n        // Trigger the first move event.\n        self.processOnMove(evt);\n    };\n\n    // Transfer it from idles to actives.\n    if ((indexInIdles = self.idles.indexOf(nipple)) >= 0) {\n        self.idles.splice(indexInIdles, 1);\n    }\n\n    // Store the nipple in the actives array\n    self.actives.push(nipple);\n    self.ids.push(nipple.identifier);\n\n    if (opts.mode !== 'semi') {\n        process(nipple);\n    } else {\n        // In semi we check the distance of the touch\n        // to decide if we have to reset the nipple\n        var distance = u.distance(position, nipple.position);\n        if (distance <= opts.catchDistance) {\n            process(nipple);\n        } else {\n            nipple.destroy();\n            self.processOnStart(evt);\n            return;\n        }\n    }\n\n    return nipple;\n};\n\nCollection.prototype.getOrCreate = function (identifier, position) {\n    var self = this;\n    var opts = self.options;\n    var nipple;\n\n    // If we're in static or semi, we might already have an active.\n    if (/(semi|static)/.test(opts.mode)) {\n        // Get the active one.\n        // TODO: Multi-touche for semi and static will start here.\n        // Return the nearest one.\n        nipple = self.idles[0];\n        if (nipple) {\n            self.idles.splice(0, 1);\n            return nipple;\n        }\n\n        if (opts.mode === 'semi') {\n            // If we're in semi mode, we need to create one.\n            return self.createNipple(position, identifier);\n        }\n\n        console.warn('Coudln\\'t find the needed nipple.');\n        return false;\n    }\n    // In dynamic, we create a new one.\n    nipple = self.createNipple(position, identifier);\n    return nipple;\n};\n\nCollection.prototype.processOnMove = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n\n    if (!nipple) {\n        // This is here just for safety.\n        // It shouldn't happen.\n        console.error('Found zombie joystick with ID ' + identifier);\n        self.manager.removeIdentifier(identifier);\n        return;\n    }\n\n    nipple.identifier = identifier;\n\n    var size = nipple.options.size / 2;\n    var pos = {\n        x: evt.pageX,\n        y: evt.pageY\n    };\n\n    var dist = u.distance(pos, nipple.position);\n    var angle = u.angle(pos, nipple.position);\n    var rAngle = u.radians(angle);\n    var force = dist / size;\n\n    // If distance is bigger than nipple's size\n    // we clamp the position.\n    if (dist > size) {\n        dist = size;\n        pos = u.findCoord(nipple.position, dist, angle);\n    }\n\n    nipple.frontPosition = {\n        x: pos.x - nipple.position.x,\n        y: pos.y - nipple.position.y\n    };\n\n    if (!opts.dataOnly) {\n        u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n\n    // Prepare event's datas.\n    var toSend = {\n        identifier: nipple.identifier,\n        position: pos,\n        force: force,\n        pressure: evt.force || evt.pressure || evt.webkitForce || 0,\n        distance: dist,\n        angle: {\n            radian: rAngle,\n            degree: angle\n        },\n        instance: nipple\n    };\n\n    // Compute the direction's datas.\n    toSend = nipple.computeDirection(toSend);\n\n    // Offset angles to follow units circle.\n    toSend.angle = {\n        radian: u.radians(180 - angle),\n        degree: 180 - angle\n    };\n\n    // Send everything to everyone.\n    nipple.trigger('move', toSend);\n    self.trigger('move ' + nipple.id + ':move', toSend);\n};\n\nCollection.prototype.processOnEnd = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n    var removedIdentifier = self.manager.removeIdentifier(nipple.identifier);\n\n    if (!nipple) {\n        return;\n    }\n\n    if (!opts.dataOnly) {\n        nipple.hide(function () {\n            if (opts.mode === 'dynamic') {\n                nipple.trigger('removed', nipple);\n                self.trigger('removed ' + nipple.id + ':removed', nipple);\n                self.manager\n                    .trigger('removed ' + nipple.id + ':removed', nipple);\n                nipple.destroy();\n            }\n        });\n    }\n\n    // Clear the pressure interval reader\n    clearInterval(self.pressureIntervals[nipple.identifier]);\n\n    // Reset the direciton of the nipple, to be able to trigger a new direction\n    // on start.\n    nipple.resetDirection();\n\n    nipple.trigger('end', nipple);\n    self.trigger('end ' + nipple.id + ':end', nipple);\n\n    // Remove identifier from our bank.\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n        self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    }\n\n    // Clean our actives array.\n    if (self.actives.indexOf(nipple) >= 0) {\n        self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (/(semi|static)/.test(opts.mode)) {\n        // Transfer nipple from actives to idles\n        // if we're in semi or static mode.\n        self.idles.push(nipple);\n    } else if (self.nipples.indexOf(nipple) >= 0) {\n        // Only if we're not in semi or static mode\n        // we can remove the instance.\n        self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n\n    // We unbind move and end.\n    self.manager.unbindDocument();\n\n    // We add back the identifier of the idle nipple;\n    if (/(semi|static)/.test(opts.mode)) {\n        self.manager.ids[removedIdentifier.id] = removedIdentifier.identifier;\n    }\n};\n\n// Remove destroyed nipple from the lists\nCollection.prototype.onDestroyed = function(evt, nipple) {\n    var self = this;\n    if (self.nipples.indexOf(nipple) >= 0) {\n        self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n    if (self.actives.indexOf(nipple) >= 0) {\n        self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n    if (self.idles.indexOf(nipple) >= 0) {\n        self.idles.splice(self.idles.indexOf(nipple), 1);\n    }\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n        self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    }\n\n    // Remove the identifier from our bank\n    self.manager.removeIdentifier(nipple.identifier);\n\n    // We unbind move and end.\n    self.manager.unbindDocument();\n};\n\n// Cleanly destroy the manager\nCollection.prototype.destroy = function () {\n    var self = this;\n    self.unbindEvt(self.options.zone, 'start');\n\n    // Destroy nipples.\n    self.nipples.forEach(function(nipple) {\n        nipple.destroy();\n    });\n\n    // Clean 3DTouch intervals.\n    for (var i in self.pressureIntervals) {\n        if (self.pressureIntervals.hasOwnProperty(i)) {\n            clearInterval(self.pressureIntervals[i]);\n        }\n    }\n\n    // Notify the manager passing the instance\n    self.trigger('destroyed', self.nipples);\n    // We unbind move and end.\n    self.manager.unbindDocument();\n    // Unbind everything.\n    self.off();\n};\n\n/* global u, Super, Collection */\n\n///////////////////////\n///     MANAGER     ///\n///////////////////////\n\nfunction Manager (options) {\n    var self = this;\n    self.ids = {};\n    self.index = 0;\n    self.collections = [];\n\n    self.config(options);\n    self.prepareCollections();\n\n    // Listen for resize, to reposition every joysticks\n    var resizeTimer;\n    u.bindEvt(window, 'resize', function (evt) {\n        clearTimeout(resizeTimer);\n        resizeTimer = setTimeout(function () {\n            var pos;\n            var scroll = u.getScroll();\n            self.collections.forEach(function (collection) {\n                collection.forEach(function (nipple) {\n                    pos = nipple.el.getBoundingClientRect();\n                    nipple.position = {\n                        x: scroll.x + pos.left,\n                        y: scroll.y + pos.top\n                    };\n                });\n            });\n        }, 100);\n    });\n\n    return self.collections;\n};\n\nManager.prototype = new Super();\nManager.constructor = Manager;\n\nManager.prototype.prepareCollections = function () {\n    var self = this;\n    // Public API Preparation.\n    self.collections.create = self.create.bind(self);\n    // Listen to anything\n    self.collections.on = self.on.bind(self);\n    // Unbind general events\n    self.collections.off = self.off.bind(self);\n    // Destroy everything\n    self.collections.destroy = self.destroy.bind(self);\n    // Get any nipple\n    self.collections.get = function (id) {\n        var nipple;\n        self.collections.every(function (collection) {\n            if (nipple = collection.get(id)) {\n                return false;\n            }\n            return true;\n        });\n        return nipple;\n    };\n};\n\nManager.prototype.create = function (options) {\n    return this.createCollection(options);\n};\n\n// Collection Factory\nManager.prototype.createCollection = function (options) {\n    var self = this;\n    var collection = new Collection(self, options);\n\n    self.bindCollection(collection);\n    self.collections.push(collection);\n\n    return collection;\n};\n\nManager.prototype.bindCollection = function (collection) {\n    var self = this;\n    var type;\n    // Bubble up identified events.\n    var handler = function (evt, data) {\n        // Identify the event type with the nipple's identifier.\n        type = evt.type + ' ' + data.id + ':' + evt.type;\n        self.trigger(type, data);\n    };\n\n    // When it gets destroyed we clean.\n    collection.on('destroyed', self.onDestroyed.bind(self));\n\n    // Other events that will get bubbled up.\n    collection.on('shown hidden rested dir plain', handler);\n    collection.on('dir:up dir:right dir:down dir:left', handler);\n    collection.on('plain:up plain:right plain:down plain:left', handler);\n};\n\nManager.prototype.bindDocument = function () {\n    var self = this;\n    // Bind only if not already binded\n    if (!self.binded) {\n        self.bindEvt(document, 'move')\n            .bindEvt(document, 'end');\n        self.binded = true;\n    }\n};\n\nManager.prototype.unbindDocument = function (force) {\n    var self = this;\n    // If there are no touch left\n    // unbind the document.\n    if (!Object.keys(self.ids).length || force === true) {\n        self.unbindEvt(document, 'move')\n            .unbindEvt(document, 'end');\n        self.binded = false;\n    }\n};\n\nManager.prototype.getIdentifier = function (evt) {\n    var id;\n    // If no event, simple increment\n    if (!evt) {\n        id = this.index;\n    } else {\n        // Extract identifier from event object.\n        // Unavailable in mouse events so replaced by latest increment.\n        id = evt.identifier === undefined ? evt.pointerId : evt.identifier;\n        if (id === undefined) {\n            id = this.latest || 0;\n        }\n    }\n\n    if (this.ids[id] === undefined) {\n        this.ids[id] = this.index;\n        this.index += 1;\n    }\n\n    // Keep the latest id used in case we're using an unidentified mouseEvent\n    this.latest = id;\n    return this.ids[id];\n};\n\nManager.prototype.removeIdentifier = function (identifier) {\n    var removed = {};\n    for (var id in this.ids) {\n        if (this.ids[id] === identifier) {\n            removed.id = id;\n            removed.identifier = this.ids[id];\n            delete this.ids[id];\n            break;\n        }\n    }\n    return removed;\n};\n\nManager.prototype.onmove = function (evt) {\n    var self = this;\n    self.onAny('move', evt);\n    return false;\n};\n\nManager.prototype.onend = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n};\n\nManager.prototype.onAny = function (which, evt) {\n    var self = this;\n    var id;\n    var processFn = 'processOn' + which.charAt(0).toUpperCase() +\n        which.slice(1);\n    evt = u.prepareEvent(evt);\n    var processColl = function (e, id, coll) {\n        if (coll.ids.indexOf(id) >= 0) {\n            coll[processFn](e);\n            // Mark the event to avoid cleaning it later.\n            e._found_ = true;\n        }\n    };\n    var processEvt = function (e) {\n        id = self.getIdentifier(e);\n        u.map(self.collections, processColl.bind(null, e, id));\n        // If the event isn't handled by any collection,\n        // we need to clean its identifier.\n        if (!e._found_) {\n            self.removeIdentifier(id);\n        }\n    };\n\n    u.map(evt, processEvt);\n\n    return false;\n};\n\n// Cleanly destroy the manager\nManager.prototype.destroy = function () {\n    var self = this;\n    self.unbindDocument(true);\n    self.ids = {};\n    self.index = 0;\n    self.collections.forEach(function(collection) {\n        collection.destroy();\n    });\n    self.off();\n};\n\n// When a collection gets destroyed\n// we clean behind.\nManager.prototype.onDestroyed = function (evt, coll) {\n    var self = this;\n    if (self.collections.indexOf(coll) < 0) {\n        return false;\n    }\n    self.collections.splice(self.collections.indexOf(coll), 1);\n};\n\nvar factory = new Manager();\nreturn {\n    create: function (options) {\n        return factory.create(options);\n    },\n    factory: factory\n};\n\n});\n"]},"metadata":{},"sourceType":"script"}